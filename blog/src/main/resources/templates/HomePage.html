<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>وبلاگ من | مقالات و آموزش‌ها</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            rtl: true,
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Vazirmatn"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://cdn.fontcdn.ir/Font/Persian/Vazirmatn/Vazirmatn-font-face.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        .post-card {
            transition: all 0.3s ease;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .post-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(79, 70, 229, 0.15);
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
        }
        .loading {
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

<!-- هدر -->
<header class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-6 flex justify-between items-center">
        <div class="flex items-center space-x-3 rtl:space-x-reverse">
            <div class="bg-indigo-600 text-white w-10 h-10 rounded-lg flex items-center justify-center">
                <i class="fas fa-blog"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-900">وبلاگ من</h1>
        </div>
        <a href="/auth/login" class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center">
            <i class="fas fa-lock mr-1"></i> ورود
        </a>
        <a href="/auth/register" class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center">
            <i class="fas fa-lock mr-1"></i> ثبت نام
        </a>
    </div>
</header>

<!-- محتوای اصلی -->
<main class="container mx-auto px-4 py-10 max-w-4xl">
    <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">آخرین مقالات</h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
            مطالب آموزشی، تحلیل‌ها و دیدگاه‌های تخصصی در حوزه‌های مختلف فناوری و برنامه‌نویسی
        </p>
    </div>

    <!-- ظرف نمایش پست‌ها -->
    <div id="posts-container" class="space-y-8">
        <!-- لودینگ -->
        <div class="post-card bg-white loading p-6">
            <div class="h-6 bg-gray-200 rounded w-1/4 mb-4"></div>
            <div class="h-8 bg-gray-200 rounded w-3/4 mb-4"></div>
            <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
            <div class="h-4 bg-gray-200 rounded w-5/6 mb-6"></div>
            <div class="h-4 bg-gray-200 rounded w-1/3"></div>
        </div>
    </div>
</main>

<footer class="bg-white border-t mt-20 py-6">
    <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
        <p>© ۱۴۰۴ وبلاگ من. تمامی حقوق محفوظ است.</p>
        <p class="mt-1">پروژه ترم دوم — ساخت وبلاگ با Spring Boot</p>
    </div>
</footer>

<script>
    function formatDate(dateStr) {
        if (!dateStr) return 'نامشخص';
        const date = new Date(dateStr);
        return date.toLocaleDateString('fa-IR');
    }

    function loadPosts() {
        const container = document.getElementById('posts-container');

        fetch('http://localhost:8080/controller-post/all')
            .then(res => {
                if (!res.ok) throw new Error('خطا در دریافت داده‌ها');
                return res.json();
            })
            .then(data => {
                const posts = Array.isArray(data) ? data : (data.content || []);

                if (posts.length === 0) {
                    container.innerHTML = `
                    <div class="text-center py-16 text-gray-500 text-lg">
                        <i class="fas fa-inbox text-4xl mb-4 opacity-60"></i><br>
                        هیچ مقاله‌ای منتشر نشده است.
                    </div>
                `;
                    return;
                }

                container.innerHTML = posts
                    .filter(post => post.status === 'PUBLISHED') // فقط منتشر‌شده‌ها
                    .map(post => `
                    <article class="post-card bg-white">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-3">
                                <span class="status-badge font-medium ${
                        post.status === 'PUBLISHED' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                    }">
                                    ${post.status === 'PUBLISHED' ? 'منتشر شده' : 'پیش‌نویس'}
                                </span>
                                <div class="flex items-center text-gray-500 text-sm">
                                    <i class="fas fa-eye ml-1"></i>
                                    <span>${post.views || 0}</span>
                                </div>
                            </div>
                            <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-3">
                             <!--   <a href="/DetailPosts.html?slug=${encodeURIComponent(post.postslug)}" class="hover:text-indigo-600 transition-colors">
    ${post.title || ''}
</a>
-->
<a href="/posts/${post.postslug}" class="hover:text-indigo-600 transition-colors">
    ${post.title || ''}
</a>

                            </h3>
                            <p class="text-gray-700 mb-4 leading-relaxed">
                                ${post.excerpt || (post.content ? post.content.substring(0, 180) + '...' : '')}
                            </p>
                            <div class="flex flex-wrap justify-between items-center text-sm text-gray-500 border-t pt-4 mt-4">
                                <div>
                                    توسط <span class="font-medium text-indigo-600">${post.author?.username || 'ناشناس'}</span>
                                    ${post.category ? `<span class="mx-2">•</span> <span>${post.category.nameCategory || post.category.name || ''}</span>` : ''}
                                </div>
                                <div class="mt-1 md:mt-0">
                                    <i class="far fa-calendar-alt ml-1"></i>
                                    <span>${formatDate(post.publishedAt || post.createdAt)}</span>
                                </div>
                            </div>
                        </div>
                    </article>
                `)
                    .join('');
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = `<div class="text-center py-10 text-red-500">❌ خطایی در بارگذاری مقالات رخ داد!</div>`;
            });
    }
loadPosts()
</script>

</body>
</html>